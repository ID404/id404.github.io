---
layout: post
title: shell脚本扫描主机端口
keywords: shell, 端口扫描
description: shell脚本扫描主机端口
categories: linux
---



将需要扫描的端口保存在scan_port.txt文件下
<p>同时新建脚本：</p>
<div class="cnblogs_code">
<pre>password=<span style="color: #800000;">"</span><span style="color: #800000;">1234</span><span style="color: #800000;">"</span><span style="color: #000000;">
timeout</span>=<span style="color: #800080;">3</span><span style="color: #000000;">
host</span>=<span style="color: #800000;">"www.xxx.com</span><span style="color: #800000;">"</span><span style="color: #000000;">

newuser</span>=<span style="color: #800000;">"</span><span style="color: #800000;">test</span><span style="color: #800000;">"</span><span style="color: #000000;">
newpass</span>=<span style="color: #800000;">"</span><span style="color: #800000;">1234</span><span style="color: #800000;">"</span><span style="color: #000000;">

cmd</span>=<span style="color: #800000;">"</span><span style="color: #800000;">cat /etc/frp/frpc.ini | grep remote_port</span><span style="color: #800000;">"</span><span style="color: #000000;">
cmd1</span>=<span style="color: #800000;">"</span><span style="color: #800000;">echo -e '$password\n' | sudo -S useradd -s '/bin/bash' -m -G adm,sudo $newuser</span><span style="color: #800000;">"</span><span style="color: #000000;">
cmd2</span>=<span style="color: #800000;">"</span><span style="color: #800000;">echo -e '$password\n' | sudo -S sudo gpasswd -a $newuser sudo</span><span style="color: #800000;">"</span><span style="color: #000000;">
cmd3</span>=<span style="color: #800000;">"</span><span style="color: #800000;">echo -e '$password\n$newpass\n$newpass\n' | sudo -S passwd $newuser</span><span style="color: #800000;">"</span><span style="color: #000000;">
cmd4</span>=<span style="color: #800000;">"</span><span style="color: #800000;">mkdir /home/ubuntu/.ssh</span><span style="color: #800000;">"</span>


<span style="color: #0000ff;">login</span><span style="color: #000000;">(){
    </span><span style="color: #0000ff;">echo</span> <span style="color: #800000;">""</span>
    <span style="color: #0000ff;">echo</span> <span style="color: #800000;">"</span><span style="color: #800000;">-------------------------------------------------------- </span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">echo</span> <span style="color: #800000;">"</span><span style="color: #800000;">username: $username  password: $password  port: $port  timeout=$timeout</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">echo</span> <span style="color: #800000;">"</span><span style="color: #800000;">command: $cmd</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">echo</span> <span style="color: #800000;">"</span><span style="color: #800000;">Remote exec command script</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">echo</span> <span style="color: #800000;">"</span><span style="color: #800000;">--------------------------------------------------------</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">echo</span> <span style="color: #800000;">""</span>

    <span style="color: #0000ff;">echo</span> <span style="color: #800000;">""</span> &gt;<span style="color: #000000;"> tmp.txt

    </span><span style="color: #0000ff;">for</span> port <span style="color: #0000ff;">in</span> $(<span style="color: #0000ff;">cat</span><span style="color: #000000;"> scan_port.txt);
    </span><span style="color: #0000ff;">do</span>
        <span style="color: #0000ff;">echo</span> <span style="color: #800000;">"</span><span style="color: #800000;">port is $port</span><span style="color: #800000;">"</span><span style="color: #000000;">
        result</span>=<span style="color: #800000;">""</span><span style="color: #000000;">
        result</span>=$(sshpass -p <span style="color: #800000;">"</span><span style="color: #800000;">$password</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">ssh</span> -p $port -o StrictHostKeyChecking=no -o ConnectTimeout=<span style="color: #000000;">$timeout $username@$host $cmd)
        </span><span style="color: #0000ff;">echo</span> $result &gt;&gt;<span style="color: #000000;"> tmp.txt
        </span><span style="color: #0000ff;">if</span> [ -z $result ]; <span style="color: #0000ff;">then</span>
            <span style="color: #0000ff;">echo</span> <span style="color: #800000;">"</span><span style="color: #800000;">port $port not open for ssh</span><span style="color: #800000;">"</span>
        <span style="color: #0000ff;">else</span><span style="color: #000000;">
            sshpass </span>-p <span style="color: #800000;">"</span><span style="color: #800000;">$password</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">ssh</span> -p $port -o StrictHostKeyChecking=no -o ConnectTimeout=<span style="color: #000000;">$timeout $username@$host $cmd1
            sshpass </span>-p <span style="color: #800000;">"</span><span style="color: #800000;">$password</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">ssh</span> -p $port -o StrictHostKeyChecking=no -o ConnectTimeout=<span style="color: #000000;">$timeout $username@$host $cmd2
            sshpass </span>-p <span style="color: #800000;">"</span><span style="color: #800000;">$password</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">ssh</span> -p $port -o StrictHostKeyChecking=no -o ConnectTimeout=<span style="color: #000000;">$timeout $username@$host $cmd3
            sshpass </span>-p <span style="color: #800000;">"</span><span style="color: #800000;">$password</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">ssh</span> -p $port -o StrictHostKeyChecking=no -o ConnectTimeout=<span style="color: #000000;">$timeout $username@$host $cmd4
            sshpass </span>-p <span style="color: #800000;">"</span><span style="color: #800000;">$password</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">ssh</span> -p $port -o StrictHostKeyChecking=no -o ConnectTimeout=<span style="color: #000000;">$timeout $username@$host $cmd5
        </span><span style="color: #0000ff;">fi</span><span style="color: #000000;">
        #</span><span style="color: #0000ff;">sleep</span> <span style="color: #800080;">3</span>
    <span style="color: #0000ff;">done</span>
    <span style="color: #0000ff;">echo</span> <span style="color: #800000;">""</span><span style="color: #000000;">
}

#exit
</span><span style="color: #0000ff;">login</span></pre>
</div>
<p>&nbsp;</p>
    
